#!/usr/bin/env bash
set -euo pipefail

echo "=== sync templates ==="
./scripts/sync-templates
echo ""

echo "=== ruff fix ==="
uv run ruff check --fix .
echo ""

echo "=== ruff check ==="
uv run ruff check .
echo ""

echo "=== pytest ==="
uv run pytest tests/ -v
echo ""

echo "=== verify templates ==="
for case_dir in templates/*/; do
    if [ -f "$case_dir/case.py" ]; then
        if [ -f "$case_dir/cassettes/llm.yaml" ]; then
            echo "--- $case_dir ---"
            uv run synix demo run "$case_dir"
        else
            echo "--- $case_dir (skipped â€” no cassettes) ---"
        fi
    fi
done
echo ""

echo "=== all checks passed ==="
